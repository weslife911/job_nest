{% extends 'components/base.html' %}

{% load static %}


{% block title %}
    All Jobs
{% endblock %}
    

{% block content %}

<style>
    body {
      font-family: 'Inter', sans-serif;
      /* Added beautiful background image for the Browse page */
      background-image: url('{% static 'images/bg-4.jpg' %}');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
    .glass-container {
        backdrop-filter: blur(10px);
        background-color: rgba(255, 255, 255, 0.2);
    }
    .main-content {
        background-color: #ffffffd0;
    }
    /* Simple style for the icon from Lucide */
    .icon {
      display: inline-block;
      width: 1.5rem;
      height: 1.5rem;
      stroke-width: 2;
      stroke: currentColor;
      fill: none;
    }
    .page-link.active {
        @apply bg-indigo-600 text-white font-bold;
    }
  </style>

<main class="container mx-auto px-6 py-12">
    <div class="glass-container rounded-3xl p-8 md:p-16 mb-12 shadow-2xl">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 text-white">Browse Job Listings</h1>
      
      <div class="bg-white/90 p-6 rounded-xl shadow-lg mb-8">
        <form class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
          <input type="text" name="job" placeholder="Job Title, Keyword..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none transition-colors duration-300">
          <input type="text" name="location" placeholder="Location" class="flex-grow p-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none transition-colors duration-300">
          <select name="job_type" class="p-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none transition-colors duration-300">
            <option>Job Type</option>
            <option>Full-time</option>
            <option>Part-time</option>
            <option>Remote</option>
            <option>Internship</option>
          </select>
          <button type="submit" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300">
            Search
          </button>
        </form>
      </div>

      <div class="job-listings-container">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          
          {% for job in page_obj  %}
            <div class="main-content rounded-xl p-6 shadow-xl hover:shadow-2xl transition-shadow duration-300 job-listing-card">
              <div class="flex items-start mb-4">
                  
                  {% if job.employer.company_logo %}
                    <img src="{{job.employer.company_logo.url}}" alt="Company Logo" class="rounded-lg mr-4 h-10">
                  {% else %}
                    <img src="https://placehold.co/64x64/E0E7FF/4F46E5?text={{job.employer.company_name|slice:':1'}}" alt="Company Logo" class="rounded-lg mr-4">
                  {% endif %}
                    
                  <div>
                      <h3 class="text-xl font-bold text-gray-900 mb-1">{{job.job_title}}</h3>
                      <p class="text-indigo-600 font-semibold">{{job.employer.company_name}}</p>
                  </div>
              </div>
              <p class="text-gray-700 mb-4">{{job.job_description|truncatewords:20}}...</p>
              <div class="flex flex-wrap gap-2 mb-4">
                  <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">{{job.job_type|capfirst}}</span>
                  {% if job.job_status|capfirst == 'pending' %}
                    <span class="text-sm font-bold text-yellow-500 capitalize">{{ job.job_status|capfirst }}</span>
                {% elif job.job_status|capfirst == 'accepted' %}
                    <span class="text-sm font-bold text-green-500 capitalize">{{ job.job_status|capfirst }}</span>
                {% elif job.job_status|capfirst == 'rejected' %}
                    <span class="text-sm font-bold text-red-500 capitalize">{{ job.job_status|capfirst }}</span>
                {% else %}
                    <span class="text-sm font-bold text-gray-500 capitalize">{{ job.job_status|capfirst }}</span>
                {% endif %}
                  <span class="bg-amber-100 text-amber-800 text-xs font-medium px-2.5 py-0.5 rounded-full">{{job.job_salary}}</span>
              </div>
              <a href="{% url 'job_details' job.id %}" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-full hover:bg-indigo-700 transition-colors duration-300">View Details</a>
          </div>
          {% endfor %}
            
          
        </div>
      </div>

      <div class="flex justify-center items-center mt-12 space-x-2">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="bg-gray-200 text-gray-700 font-bold py-3 px-5 rounded-lg shadow-md hover:bg-gray-300 transition-colors duration-300">
            &laquo; Previous
        </a>
    {% else %}
        <span class="bg-gray-200 text-gray-700 font-bold py-3 px-5 rounded-lg shadow-md opacity-50 pointer-events-none">
            &laquo; Previous
        </span>
    {% endif %}

    <div id="pagination-numbers" class="flex items-center space-x-2">
        {% for page_number in page_obj.paginator.page_range %}
            <a href="?page={{ page_number }}" class="page-link py-3 px-5 rounded-lg shadow-md transition-colors duration-300 hover:bg-indigo-700 hover:text-white hover:font-bold {% if page_obj.number == page_number %}bg-indigo-600 text-white font-bold{% else %}bg-gray-200 text-gray-700{% endif %}">
                {{ page_number }}
            </a>
        {% endfor %}
    </div>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="bg-indigo-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300">
            Next &raquo;
        </a>
    {% else %}
        <span class="bg-indigo-600 text-white font-bold py-3 px-5 rounded-lg shadow-md opacity-50 pointer-events-none">
            Next &raquo;
        </span>
    {% endif %}
</div>
  </main>

<script>
        // Mobile menu toggle logic
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Pagination Logic
        const jobListingsContainer = document.querySelector('.job-listings-container .grid');
        const jobCards = document.querySelectorAll('.job-listing-card');
        const jobsPerPage = 3;
        const totalJobs = jobCards.length;
        const totalPages = Math.ceil(totalJobs / jobsPerPage);
        let currentPage = 1;

        const paginationNumbersContainer = document.getElementById('pagination-numbers');
        const prevButton = document.getElementById('prev-page');
        const nextButton = document.getElementById('next-page');

        function displayJobs(page) {
            const start = (page - 1) * jobsPerPage;
            const end = start + jobsPerPage;
            
            // Clear existing job cards
            jobListingsContainer.innerHTML = '';

            // Get a new array of job cards for the current page
            const paginatedJobs = Array.from(jobCards).slice(start, end);

            // Append them to the container
            paginatedJobs.forEach(card => jobListingsContainer.appendChild(card));
        }

        function setupPagination() {
            paginationNumbersContainer.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const pageLink = document.createElement('a');
                pageLink.href = '#';
                pageLink.textContent = i;
                pageLink.classList.add('page-link', 'py-3', 'px-5', 'rounded-lg', 'shadow-md', 'transition-colors', 'duration-300', 'hover:bg-indigo-700', 'hover:text-white', 'hover:font-bold');
                pageLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    updatePagination();
                });
                paginationNumbersContainer.appendChild(pageLink);
            }
        }

        function updatePagination() {
            displayJobs(currentPage);

            // Update active class for page numbers
            document.querySelectorAll('.page-link').forEach(link => {
                link.classList.remove('active', 'bg-indigo-600', 'text-white', 'font-bold', 'bg-gray-200', 'text-gray-700');
                if (parseInt(link.textContent) === currentPage) {
                    link.classList.add('active', 'bg-indigo-600', 'text-white', 'font-bold');
                } else {
                    link.classList.add('bg-gray-200', 'text-gray-700');
                }
            });

            // Update button states
            if (currentPage === 1) {
                prevButton.classList.add('opacity-50', 'pointer-events-none');
            } else {
                prevButton.classList.remove('opacity-50', 'pointer-events-none');
            }

            if (currentPage === totalPages) {
                nextButton.classList.add('opacity-50', 'pointer-events-none');
            } else {
                nextButton.classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        prevButton.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        });

        nextButton.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        });
        
        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            setupPagination();
            updatePagination();
        });
    </script>

{% endblock %}