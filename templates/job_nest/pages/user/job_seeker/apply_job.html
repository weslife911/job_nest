{% extends 'components/base.html' %}

{% load static %}

{% block title %}
    Apply for Job
{% endblock %}

{% block content %}

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-image: url('/static/images/bg-5.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }
    .glass-container {
        backdrop-filter: blur(10px);
        background-color: rgba(255, 255, 255, 0.2);
    }
    .step-indicator-container {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.step-indicator {
    width: 30px;
    height: 30px;
    background-color: #e2e8f0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    font-weight: bold;
    transition: background-color 0.3s ease, color 0.3s ease;
    position: relative;
    z-index: 1;
}
.step-indicator.active {
    background-color: #4f46e5;
    color: #ffffff;
}
.step-indicator.complete {
    background-color: #10b981;
    color: #ffffff;
}
.step-indicator:not(:last-child)::after {
    content: '';
    position: absolute;
    width: 60px; /* Adjust length of the line */
    height: 2px;
    background-color: #e2e8f0;
    left: calc(100% + 5px);
    top: 50%;
    transform: translateY(-50%);
    z-index: 0;
}
.step-indicator.complete:not(:last-child)::after {
    background-color: #10b981;
}
    .connector-line {
        @apply w-20 h-1 rounded-full transition-all duration-500 ease-in-out;
    }
    .connector-line.active {
        background: linear-gradient(90deg, #fde68a, #f9a8d4);
        animation: expand-line 0.7s forwards;
    }
    
    /* Keyframe Animations */
    @keyframes pulse-glow {
        from {
            transform: scale(1);
            box-shadow: 0 0 15px rgba(253, 230, 138, 0.8), 0 0 30px rgba(249, 168, 212, 0.6);
        }
        to {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(253, 230, 138, 1), 0 0 40px rgba(249, 168, 212, 0.8);
        }
    }
    
    @keyframes expand-line {
        from {
            width: 0;
        }
        to {
            width: 5rem; /* 80px */
        }
    }
</style>

<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-24 flex items-center justify-center">
    <div class="glass-container w-full max-w-3xl mx-auto rounded-xl p-8 shadow-2xl border border-white border-opacity-30">
        <div class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white mb-2">Apply for a Job</h1>
            <p class="text-lg text-gray-200">Fill out the form below to submit your application.</p>
        </div>

        <div class="mb-8 p-6 rounded-xl bg-white/20 shadow-md backdrop-blur-sm border border-white/30 text-white">
            <h2 class="text-2xl font-bold mb-2">{{job.job_title}}</h2>
            <div class="flex items-center space-x-4 text-sm text-gray-200">
                <p class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase mr-1 text-gray-300"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/><rect width="20" height="14" x="2" y="6" rx="2"/></svg>
                    {{job.employer.company_name}}
                </p>
                <p class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-1 text-gray-300"><path d="M12 16.5c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4Z"/><path d="M12 21.75C8.85 21.75 4 17.5 4 12c0-5 3.5-9 8-9s8 4 8 9c0 5.5-4.85 9.75-8 9.75Z"/></svg>
                    {{job.employer.company_location}}
                </p>
                <p class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-circle-dollar-sign mr-1 text-gray-300"><circle cx="12" cy="12" r="10"/><path d="M10 16h4c.7 0 1.5-.5 1.5-1.5s-.8-1.5-1.5-1.5H10c-.7 0-1.5-.5-1.5-1.5S9.3 9 10 9h4"/><line x1="12" x2="12" y1="16" y2="9"/></svg>
                    {{job.salary}}
                </p>
            </div>
        </div>

        <div class="step-indicator-container flex justify-center items-center space-x-2">
            <div id="step-1-indicator" class="step-indicator active">1</div>
            <div id="step-2-indicator" class="step-indicator">2</div>
        </div>

        <form id="applyForm" action="{% url 'apply_job' job.id %}" method="post" class="space-y-6">
            {% csrf_token %}
            <div id="step-1" class="form-step">
                <h2 class="text-2xl font-bold text-white mb-4">1. Application Details</h2>
                <div class="p-6 bg-white/10 rounded-lg space-y-4">
                    <div>
                        <label for="desiredSalary" class="block text-sm font-medium text-white mb-1">Desired Salary ($ per year)</label>
                        <input type="number" id="desired_salary" name="desired_salary" min="0" required class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition-all duration-300 placeholder-gray-300" placeholder="e.g., $500k - $1M">
                    </div>
                    <div>
                        <label for="availability" class="block text-sm font-medium text-white mb-1">Earliest Availability Start Date</label>
                        <input type="date" id="availability" name="availability" required class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition-all duration-300 placeholder-gray-300">
                    </div>
                    <div>
                        <label for="referral" class="block text-sm font-bold text-white mb-2 tracking-wide drop-shadow-sm">
                            How did you hear about this job?
                        </label>
                        <div class="relative">
                            <select id="referral" name="referral"
                                class="block w-full px-4 py-3 rounded-xl appearance-none bg-white/10 text-white border border-white/20 shadow-inner
                                        focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition-all duration-300 cursor-pointer">
                                <option class="text-gray-400 bg-gray-800" value="">
                                    Choose an option
                                </option>
                                <option class="bg-gray-800 text-white" value="Company Website">Company Website</option>
                                <option class="bg-gray-800 text-white" value="Social Media">Social Media</option>
                                <option class="bg-gray-800 text-white" value="Friend">Friend</option>
                                <option class="bg-gray-800 text-white" value="Other">Other</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="coverLetter" class="block text-sm font-medium text-white mb-1">Cover Letter</label>
                        <textarea id="coverLetter" name="cover_letter" rows="6" class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition-all duration-300 placeholder-gray-300" placeholder="Write a brief cover letter..."></textarea>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button type="button" id="next-1" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-transform duration-300 transform hover:scale-105">
                        Next
                    </button>
                </div>
            </div>

            <div id="step-3" class="form-step hidden">
                <h2 class="text-2xl font-bold text-white mb-4">2. Additional Information</h2>
                <div class="p-6 bg-white/10 rounded-lg space-y-4">
                    <h3 class="text-xl font-semibold text-white">Additional Information</h3>
                    <div>
                        <label for="additionalNotes" class="block text-sm font-medium text-white mb-1">Additional Notes</label>
                        <textarea id="additionalNotes" name="additional_notes" rows="4" class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition-all duration-300 placeholder-gray-300" placeholder="Please provide any other information you think is relevant..."></textarea>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" id="back-2" class="bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition-transform duration-300 transform hover:scale-105">
                        Back
                    </button>
                    <button type="submit" class="w-1/2 sm:w-auto bg-amber-400 text-indigo-900 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-300 transition-all duration-300">
                        Submit Application
                    </button>
                </div>
            </div>

        </form>
    </div>
</main>

<script>
    // Multi-step form logic
    document.addEventListener('DOMContentLoaded', () => {
        const applyForm = document.getElementById('applyForm');
        const steps = document.querySelectorAll('.form-step');
        const indicators = document.querySelectorAll('.step-indicator');
        
        let currentStep = 0;

        function updateProgress(stepIndex) {
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === stepIndex);
                if (index < stepIndex) {
                    indicator.classList.add('complete');
                } else {
                    indicator.classList.remove('complete');
                }
            });
        }

        function showStep(stepIndex) {
            // Hide all steps
            steps.forEach(step => step.classList.add('hidden'));
            // Show the current step
            steps[stepIndex].classList.remove('hidden');

            // Update indicators
            updateProgress(stepIndex);
            currentStep = stepIndex;
        }

        // Event listeners for navigation buttons
        document.getElementById('next-1').addEventListener('click', () => {
                showStep(1);
        });
        document.getElementById('back-2').addEventListener('click', () => showStep(0)); // Go back to step 1
        
        // Show the first step on page load
        showStep(0);
    });
</script>


{% endblock %}