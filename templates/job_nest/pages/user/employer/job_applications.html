{% extends 'components/base.html' %}

{% load static %}


{% block title %}
    Job Applications
{% endblock %}
    

{% block content %}

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f3f4f6;
    }
</style>

<main class="container mx-auto px-6 py-12 flex-grow">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-xl">
        <h1 id="job-title" class="text-3xl font-bold text-center text-gray-800 mb-8">Applicants for: [Job Title]</h1>
        
        <!-- Applicants List -->
        <div id="applicant-list" class="space-y-6">
            
            {% for application in applications  %}
                <div class="p-6 rounded-lg bg-gray-50 shadow flex items-center justify-between">
                    <div>
                        <h3 class="font-semibold text-gray-800 text-lg">{{application.job_seeker.full_name}}</h3>
                        <p class="text-sm text-gray-500">Applied: {{application.created|timesince}}</p>
                        <p class="text-sm text-gray-500">
                            For position: {{application.job.job_title}}
                        </p>
                    </div>
                    <div class="text-sm text-right">
                        <p class="text-gray-700">Desired Salary: ${{application.desired_salary}}</p>
                        <p class="text-gray-700 mt-1">Availability: {{application.availability}}</p>
                        <a href="{% url 'application_details' application.id %}" class="mt-2 inline-block bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-indigo-700 transition-colors duration-200">View Application</a>
                    </div>
                </div>
            {% empty %}
                <p class="text-center text-gray-500">No applicants for this job yet.</p>
            {% endfor %}
                
        </div>

        <!-- Pagination Controls -->
        <div class="flex justify-center items-center space-x-2 mt-8">
            {% if applications.has_previous %}
                <a href="?page={{ applications.previous_page_number }}" class="bg-white px-4 py-2 rounded-lg text-gray-700 font-semibold border border-gray-300 hover:bg-gray-200 transition-colors duration-200">Previous</a>
            {% endif %}
            <span class="px-4 py-2 text-gray-700">Page {{ applications.number }} of {{ applications.paginator.num_pages }}</span>
            {% if applications.has_next %}
                <a href="?page={{ applications.next_page_number }}" class="bg-white px-4 py-2 rounded-lg text-gray-700 font-semibold border border-gray-300 hover:bg-gray-200 transition-colors duration-200">Next</a>
            {% endif %}
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // Placeholder data for demonstration.
        // In a real application, you'd fetch this dynamically based on the job_id from the URL.
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('job_id');

        const applicantsPerPage = 5;
        let currentPage = 1;
        
        const applicantList = document.getElementById('applicant-list');
        const prevButton = document.getElementById('prev-page');
        const nextButton = document.getElementById('next-page');
        const pageNumbersDiv = document.getElementById('page-numbers');
        const jobTitleElement = document.getElementById('job-title');

        jobTitleElement.textContent = `Applicants for: ${jobTitle}`;

        function renderApplicants() {
            const startIndex = (currentPage - 1) * applicantsPerPage;
            const endIndex = startIndex + applicantsPerPage;
            const applicantsToRender = allApplicants.slice(startIndex, endIndex);
            
            renderPaginationControls();
        }

        function renderPaginationControls() {
            const totalPages = Math.ceil(allApplicants.length / applicantsPerPage);
            pageNumbersDiv.innerHTML = '';

            // Previous button state
            prevButton.disabled = currentPage === 1;
            prevButton.classList.toggle('opacity-50', currentPage === 1);

            // Page number links
            for (let i = 1; i <= totalPages; i++) {
                const pageLink = document.createElement('a');
                pageLink.href = '#';
                pageLink.textContent = i;
                pageLink.className = `px-3 py-1 rounded-lg font-semibold transition-colors duration-200 ${
                    i === currentPage ? 'bg-indigo-600 text-white' : 'text-gray-700 bg-white hover:bg-gray-200'
                }`;
                pageLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    renderApplicants();
                });
                pageNumbersDiv.appendChild(pageLink);
            }

            // Next button state
            nextButton.disabled = currentPage === totalPages;
            nextButton.classList.toggle('opacity-50', currentPage === totalPages);
        }

    });
</script>

{% endblock %}